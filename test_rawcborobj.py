import unittest
import time
from rawcborobj import rawcborobj

class TestRawCBORObj(unittest.TestCase):

    def test_simple_arrays1(self):
        c = rawcborobj(bytes.fromhex("84030405820119ffff"))
        self.assertEqual(c[0].value, 3)
        self.assertEqual(c[1].value, 4)
        self.assertEqual(c[2].value, 5)
        self.assertEqual(str(c[0]), "3")
        self.assertEqual(str(c[1]), "4")
        self.assertEqual(str(c[2]), "5")
        self.assertEqual(len(c[3]), 2)
        self.assertEqual(c[3][0].value, 1)
        self.assertEqual(c[3][1].value, 65535)

    def test_indefinite_array(self):
        c = rawcborobj(bytes.fromhex("9f01020304050607ff"))
        self.assertEqual(len(c), 7)
        self.assertEqual(c[3].value, 4)

    def test_simple_map(self):
        c = rawcborobj(bytes.fromhex("a201080209"))
        self.assertEqual(c[1].value, 8)
        self.assertEqual(c[2].value, 9)

    def test_nested_stuff1(self):
        encoded_str = "9fa19f10ff00a19f10ff01ff"
        c = rawcborobj(bytes.fromhex(encoded_str))
        self.assertEqual(c.encoded(), encoded_str)
        self.assertEqual(c[0].encoded(), "a19f10ff00")
        self.assertEqual(c[0].keys_encoded(), ['9f10ff'])

    def test_nested_stuff2(self):
        encoded_str = "a3820304070507a20102020501"
        c = rawcborobj(bytes.fromhex(encoded_str))
        self.assertEqual(c.keys_encoded(), ['820304', '05', 'a201020205'])

        self.assertEqual(c[rawcborobj(bytes.fromhex('820304'))].value, 7)
        self.assertEqual(c[rawcborobj(bytes.fromhex('05'))].value, 7)
        self.assertEqual(c[5].value, 7)
        self.assertEqual(c[rawcborobj(bytes.fromhex('a201020205'))].value, 1)

    def test_nested_stuff3(self):
        c = rawcborobj(bytes.fromhex("9fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0dbba000ffffffffd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0f731400ffffffffff"))

        self.assertEqual(len(c), 2)
        self.assertEqual(c[0].tag, 121)

        self.assertEqual(c[0][0].value.hex(), '7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7')

        self.assertEqual(c[0][0].tag, None)

        self.assertTrue(c[0][1].encoded().startswith('9f'))

        self.assertEqual(c[0][1][0][1].keys_encoded(), ['40'])
        self.assertEqual(c[0][1][0][1]['40'][1]['40'].value, 4800000)
        self.assertEqual(c[0][1][0][1]['40'].tag, 121)
        self.assertEqual(c[0][1][0][1]['40'][1].tag, None)
        self.assertEqual(c[0][1][0][1]['40'][1]['40'].tag, None)

        self.assertEqual(c[0][1][0][1][b'@'][1][bytes.fromhex('40')].value, 4800000)

    def test_raw_tx(self):
        raw_bytes = bytes.fromhex("84ab00828258209faa7b31a7f47fda01f907c579f1c2fb3812969089c81ff92fc433d108438eea048258201c634f0c203fba5716cdf78a3d8673944fb76b2b7ecc9c2b3b9048e5c985dd43020183835839119068a7a3f008803edac87af1619860f2cdcde40c26987325ace138ad81728e7ed4cf324e1323135e7e6d931f01e30792d9cdf17129cb806d821a0013991ca1581cf0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9aa14436343233015820953c26461c9422cb80c9dcfb6bd57622630b222e9b757cd1628fde3105c34c17825839017b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4c1a07270e00825839017b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4c1a07221d78021a0004f088031a051199860758200cdc253a211c4a6cf6d428562b6c708ff7d3c8b5a9c63161e84e4771d6a191ea0b5820fca1526944b39461d80348e553c667b3fefbcf9d4ddb410e1d3f818cdb2fe6630d8182582060ae0bc83d557c3f0c5fc48f81edbc257be494ef9279693285c0c2b4b97b2514000e81581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f710825839017b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4c1a0044e274111a000768cc12818258209a32459bd4ef6bbafdeb8cf3b909d0e3e2ec806e4cc6268529280b0fc1d06f5b00a3008182582006bcbf19c904cb7053226c030034e44cad1e354c8c7ff68e6a3cd836658e0f52584098368f7f21573e60f96f5c3dded511cfe3eda741b7bce1556780732c77b5e52e7559d0facb8ba7fd22b1849ac09b1a8c902d44e0c7f5fab9dc0826fd7d86800f049fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0dbba000ffffffffd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0f731400ffffffffff0581840001d87980821a000e328c1a123ff92ff5ac181e613518327840643837393966353831633762363635396565346564376233346662383266336365653865316333306139353430656436663734366630396534366239363537371833784066373966643837393966643837393966643837393966353831633333343263613863303733613131623736363462643130353132333335336537396330313131183478403663633436353931353133336664636637356666643837393966643837393966643837393966353831636436633566366637353632313432623938313565616318357840633331613361313537393939313435326538363061616636303537333732323031386666666666666666613134306438373939663030613134303161303034391836784033653030666666666438373939666438373939666438373939663538316337306536306633623565613731353365306163633761383033653434303164343462183778403865643162616531633762616161643161363261373266666438373939666438373939666438373939663538316331653738616165376339306363333664363218387840346637623362623664383662353236393664633834653439306633343365626138393030356666666666666666666131343064383739396630306131343031611839784030303439336530306666666664383739396664383739396664383739396635383163376236363539656534656437623334666238326633636565386531633330183a784061393534306564366637343666303965343662393635373766376666643837393966643837393966643837393966353831633137383330356330626431323338183b784035356464343433333131326436303831653339303664323565386236316138353734656264616665346366666666666666666131343064383739396630306131183c7534303161306462626130303066666666666666662c")
        c = rawcborobj(raw_bytes)
        self.assertTrue(c[1][4][0].encoded().startswith("d8799f581c7b6659ee4ed7b34"))

    def test_raw_tx2(self):
        raw_bytes = bytes.fromhex("84a90087825820d98c5b48a0f2ca102a09cca3035870105c09f32643baeb448ba39fd8aee9756c008258201e43ab4d20785598dcad31c4190a9a3f088889682c52802cada12ca159f52d6800825820ba028efba6496be5a9c066fd0bd568452974d80e90379894edb6b646a1d2b88b01825820d9b95c6dde8f364263d8dc13f6c4ea159b6c4300bbeeabdc71e935d1c94eb78801825820b2cc9d896832ab141a1cddc62bd8df00eb05c7299688bd28ee71ef93a6ea904100825820ba028efba6496be5a9c066fd0bd568452974d80e90379894edb6b646a1d2b88b02825820b2cc9d896832ab141a1cddc62bd8df00eb05c7299688bd28ee71ef93a6ea90410201981882583901a1ed08334901473cc30c9c3b5917c5df973d5591e3733da87bd25348663a8fb1c88f7c15069faebb39bd8b34a6cf70552045da207f1d03bf1a000ecc16825839017120853d638c1ecddf3d730ebe7e8ff21647c957ea1bc1f83ab9f2a6642666d76c177c36ab9dd77accd79147db2ef7efeb5199ee464e0d2e1a0054afb08258390170e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a721e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005f1a0021dfe082583901fec51bf6a9ede89ee656ff173df23bd8692373c1760967d115a12bd1967f89edb8109c2e63fec0553fa5a8b5d0450a143fa72c623a341ade1a06272a3082583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a00242bc4a5581c179dd4922c947166ca8ce3321be2d9f23232c7c1f8e3dd91cca82b22a14a4a756e6b69653136393601581c17e912c494a3095ebf5d0babd1a0a6d51c0527da5906516272eb87caa14f53656372657442756c6c733033323501581c19466e80daf3d595618953bbb0bb920aec01b872af35086acacf5854a2514d6167696376657273654361726430313101514d6167696376657273654361726430333001581c1c7c26a09e68a19e0fc0f6b1e0e7f0e9521fb0d3252d799efdc15d4ba1454d414749431a00012291581c200d7ee86272e083a53d9d97982523b4beb67f2e1fe81c1b27d131bfaf44303033390144303134340144303235360144303332380144303433320144303433340144303532370144303631330144303730330144303735330144303834350144303930350144303930370144313130330144313134310182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0018dbfca1581c200d7ee86272e083a53d9d97982523b4beb67f2e1fe81c1b27d131bfb444313332390144313536300144313536330144313631310144313632360144313635390144313730380144313733320144313734360144313737330144323035310144323131360144323335330144323339320144323435360144323531300144323532330144323630310144323930310144333030350182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a00209ea0a3581c200d7ee86272e083a53d9d97982523b4beb67f2e1fe81c1b27d131bfaf443330393201443330393901443331393401443332343201443333343301443334383801443337303601443337323001443337393701443431363801443431373101443432303501443433333501443433343001443434303801581c5329a9b87459e1df8e86ce56bae4b3770862c0969011e6faf474b65fa1544f7065726174697665536972486f737365676f7201581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194a44e5468655769746368657330303036014e5468655769746368657330303131014e5468655769746368657330303232014e54686557697463686573303034330182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0026032ca1581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194b44e5468655769746368657330303635014e5468655769746368657330303934014e5468655769746368657330313133014e5468655769746368657330313738014e5468655769746368657330323432014e5468655769746368657330333038014e5468655769746368657330333334014e5468655769746368657330333435014e5468655769746368657330333633014e5468655769746368657330333838014e5468655769746368657330343038014e5468655769746368657330343430014e5468655769746368657330343534014e5468655769746368657330343635014e5468655769746368657330343730014e5468655769746368657330343732014e5468655769746368657330353435014e5468655769746368657330353737014e5468655769746368657330363030014e54686557697463686573303632320182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0026032ca1581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194b44e5468655769746368657330363235014e5468655769746368657330363333014e5468655769746368657330363334014e5468655769746368657330363335014e5468655769746368657330363532014e5468655769746368657330363632014e5468655769746368657330363738014e5468655769746368657330373238014e5468655769746368657330373434014e5468655769746368657330373533014e5468655769746368657330373731014e5468655769746368657330373836014e5468655769746368657330373839014e5468655769746368657330393634014e5468655769746368657331303235014e5468655769746368657331303331014e5468655769746368657331303436014e5468655769746368657331303532014e5468655769746368657331303731014e54686557697463686573313133350182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0026032ca1581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194b44e5468655769746368657331313738014e5468655769746368657331313837014e5468655769746368657331313839014e5468655769746368657331323230014e5468655769746368657331323531014e5468655769746368657331323533014e5468655769746368657331323538014e5468655769746368657331323635014e5468655769746368657331323735014e5468655769746368657331323835014e5468655769746368657331333137014e5468655769746368657331333839014e5468655769746368657331343033014e5468655769746368657331343332014e5468655769746368657331343339014e5468655769746368657331343733014e5468655769746368657331353137014e5468655769746368657331363536014e5468655769746368657331373431014e54686557697463686573313735300182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0026032ca1581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194b44e5468655769746368657331373531014e5468655769746368657331373935014e5468655769746368657331373936014e5468655769746368657331373937014e5468655769746368657331383431014e5468655769746368657331393331014e5468655769746368657331393337014e5468655769746368657332303530014e5468655769746368657332313031014e5468655769746368657332313339014e5468655769746368657332323537014e5468655769746368657332323538014e5468655769746368657332323834014e5468655769746368657332323935014e5468655769746368657332333435014e5468655769746368657332343230014e5468655769746368657332353133014e5468655769746368657332353139014e5468655769746368657332353236014e54686557697463686573323537360182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0026032ca1581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194b44e5468655769746368657332363131014e5468655769746368657332363534014e5468655769746368657332363633014e5468655769746368657332373031014e5468655769746368657332373037014e5468655769746368657332373130014e5468655769746368657332373137014e5468655769746368657332373431014e5468655769746368657332373630014e5468655769746368657332373632014e5468655769746368657332373637014e5468655769746368657332383337014e5468655769746368657332383932014e5468655769746368657332393133014e5468655769746368657332393134014e5468655769746368657332393136014e5468655769746368657333303139014e5468655769746368657333303339014e5468655769746368657333303432014e54686557697463686573333037360182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a002a8cdaa3581c5faa758bb5b9737fa3175abb7399511ea1711a8472422aceb0f84194a94e5468655769746368657333303839014e5468655769746368657333313031014e5468655769746368657333313038014e5468655769746368657333313133014e5468655769746368657333313339014e5468655769746368657333323135014e5468655769746368657333323137014e5468655769746368657333333038014e546865576974636865733333323401581c60d2f581479d2e4b82a4e820afac6c2848b5bca804f677f624761910a1514261747320616e6420436174732030343901581c6d69e1969581ed7349cde32940769103020d24462aecba19b72652c7aa4e46757475726546726f6773313335014e46757475726546726f6773323132014e46757475726546726f6773323133014e46757475726546726f6773323134014e46757475726546726f6773323135014e46757475726546726f6773323136014f46757475726546726f677331303430014f46757475726546726f677332353037014f46757475726546726f677334303736014f46757475726546726f6773343238310182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a002d8278a6581c6d69e1969581ed7349cde32940769103020d24462aecba19b72652c7a54e46757475726546726f6773363337014e46757475726546726f6773363837014f46757475726546726f677335323939014f46757475726546726f677336313531014f46757475726546726f67733632313001581c82b6c09352c35a99a85a1a4615f3cca23e61f92dc18d59856ab87faea1544e6f6e46756e6769626c65446576696c3234373601581ca587ce7893ec56fa6136e483499d2a8210e29c34b7dc673446128875a350436861696e734f6657617230333437370150436861696e734f6657617230353436300150436861696e734f66576172303630383101581cb333a7235f9b9006c02152621c30c34cfd8ce7b32f7c450c9b2b341aa14c53703463334d336e3030363501581cc5106bb7bad3b186563122fa936970e1532889707819ee28df87e8e8a3443135353801443136363801443233343301581cd0bf642ffd6346ac1cd436584f4ae934b5de37c1f410b7682827373aa74a42554c4c6f6f6e323630014a42554c4c6f6f6e343331014a42554c4c6f6f6e353037014b42554c4c6f6f6e31333230014b42554c4c6f6f6e31383736014b42554c4c6f6f6e32383131014b42554c4c6f6f6e323931350182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0023e86ca4581cd0bf642ffd6346ac1cd436584f4ae934b5de37c1f410b7682827373aa34a42554c4c6f6f6e353238014a42554c4c6f6f6e363732014a42554c4c6f6f6e39383401581cd6dcb7b665b9f57937f58134d6608e53af37c819a00557ea5b9b82f6aa4972306269743033313301497230626974303331340149723062697430333239014972306269743038303501497230626974303830360149723062697430383037014972306269743039313701497230626974303931380149723062697430393139014972306269743130373701581cdcd679b44c93d1613639d95af123b04c96de062ac702dad3400254aba14b437962657258303438373101581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984daa644303038390144303230340144303333350144303334390144303438300144303439300182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0018dbfca1581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984dab444303530370144303531320144303532370144303533310144303535390144303537300144303537350144303632380144303634320144303635360144303638370144303731310144303731330144303732310144303830330144303831350144303833380144303833390144303835310144303835330182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0018dbfca1581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984dab444303836330144303931360144303931390144303934330144303935310144303936350144313030330144313032390144313036320144313038350144313134360144313138350144313230340144313232370144313233330144313235350144313333300144313339360144313434330144313436340182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0018dbfca1581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984dab444313439310144313533330144313537340144313630310144313630370144313631310144313634380144313636390144313731390144313736300144313830390144313831320144313832340144313835320144313839350144313937320144323032360144323035360144323038390144323132350182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a0018dbfca1581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984dab444323133330144323134300144323135380144323230320144323234300144323334340144323339330144323431350144323436370144323530340144323531390144323533330144323534350144323631380144323632370144323639360144323730390144323733310144323830370144323836300182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce01821a001c8acca3581cde92f0fd9b5d83f813ca944f4d2c73dc6d300cda7eb078729ff984daaf443239303201443239303501443239333001443239333801443239343701443239373001443239373101443239373201443330353601443330373901443331363501443332323201443332343301443332393201443333313501581ceaa972045049185981aca9f4aaad38bc307776c593e4a849d3802a87a14e536d6f6f7468596574693530323301581cf0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9aa1467a69676779780182583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce011a2e388a4982583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce011a171c452582583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce011a0b8e229282583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce011a0b7b7083021a0012b210031a0512bddc0b5820081d5db5f964a98d8bc6ab92535e2ed258b19e07cfa633c00f1d6d0309239d610d81825820b2cc9d896832ab141a1cddc62bd8df00eb05c7299688bd28ee71ef93a6ea9041021082583901e7648b24b05e59d2ab3b9777d0cbae0392dafb6583f5e15d6865365e34df2490aa4f61557c7dbb7c7620e5dec747fc1e1d6d22d54dc1ce011a003b47d6111a001c0b1812818258209a32459bd4ef6bbafdeb8cf3b909d0e3e2ec806e4cc6268529280b0fc1d06f5b00a30083825820dce2b8287590a47c7f47769ed360defae60fb8ada8d13a2eb2ed61785205326c5840aa98ce94487c0a8eb6376c6f4e235c3fd3b791557d0e3f96353b608921b5406015c358145d0db48230cbd13f0b2b97bc7adb014e9aa2465f0edc9fe822af8b09825820316a4a61346af6945075c8b9c5d03361369fbf1af7aab185634d33b1cb523e965840ecaaa831e8494bdf2e58b78ac8c8f0ff7895474fd5b5f100156b9e2eb6212df80e7e019a10b20d1aee3f254ffde819eb6c99cd0fc350889df6302cf459b6da03825820de1ae200d0c07b971130c544aa7dc3a9f5c846f536697c5a9820c8df3e34a1fa5840b6338e9739ce65b32e598282978ed63ad741da99e6af8bc6c3725f22939e5b16788dd3497d28365477fc1336fd07f0c732c08e9cd5a700cde7ff26faf633410b049fd8799f581cfec51bf6a9ede89ee656ff173df23bd8692373c1760967d115a12bd19fd8799fd8799fd8799f581c7120853d638c1ecddf3d730ebe7e8ff21647c957ea1bc1f83ab9f2a6ffd8799fd8799fd8799f581c642666d76c177c36ab9dd77accd79147db2ef7efeb5199ee464e0d2effffffffa140d8799f00a1401a0054afb0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a0021dfe0ffffd8799fd8799fd8799f581cfec51bf6a9ede89ee656ff173df23bd8692373c1760967d115a12bd1ffd8799fd8799fd8799f581c967f89edb8109c2e63fec0553fa5a8b5d0450a143fa72c623a341adeffffffffa140d8799f00a1401a06272a30ffffffffff0581840005d87a80821a0090eada1aa8d3d03df5f6")
        c = rawcborobj(raw_bytes)

    def test_raw_tx3(self):
        raw_bytes = bytes.fromhex("84ab008682582011ef267b894b7b08056c344f358c09478a3045cd2b61566934342c35be460bfd01825820ba46319c20d35a2c3d54df0dfc0bda5f67d38daf48175aa11e4fae619a6a50b500825820ba46319c20d35a2c3d54df0dfc0bda5f67d38daf48175aa11e4fae619a6a50b501825820c2f017422a94a5fb37524c8c13cef22ec03b6c42f54f9cb08b6ca9dfdaf3138f01825820c6191faf6bca57ae90cf214b8d3ae6dfec8ab930e5dea33f2ec6f8f24a89f71301825820e01d9c0d8709d20c1dbd35de02984cfb80094ed3dd418c6521a9762f57614cac010184a300581d70081600df43ed3cc0f404ae7d3ba28ecc680aa63826e15807a13d47b6011a00124f80028201d8185826d8799f58206b791f703697e54736fa4bd00ba8b861f154c3441cb7437970157bd88c13d485ffa200581d60df818d4c941a721590ce4ded885e2d908240e545ef8cf24392fb0c7e01821a00989680a1581c6d8b234f4d0ecb7808f5132034eb0cb90207f2727e4f0bc83f57b57ca14454554e411b000000038407b700a20058390065647d1979b1f2438fb8133811bbcd2f08a685251509bd6525a4c4ad3d654b905de11caa424287b4151712734de673af463f4ec9ef98b98601821b0000000305a07a21a3581c41867ef4e53f41681b808230cffc066caa94e769c6db52632d5bea13a15054554e4130303030303030303030313501581c6d8b234f4d0ecb7808f5132034eb0cb90207f2727e4f0bc83f57b57ca14454554e411b000003c3fd1c5b00581cef7a1cebb2dc7de884ddf82f8fcbc91fe9750dcd8c12ec7643a99bbea1581cdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef01a300581d7041867ef4e53f41681b808230cffc066caa94e769c6db52632d5bea1301821a001e8480a1581c41867ef4e53f41681b808230cffc066caa94e769c6db52632d5bea13a14001028201d8185849d8799f19270f784064343664303537373938303239346133346539623139376630396364643733383637373933353538306238323962323336306235656261396431383466396432ff021a0010c6960758206a4469a6ce78b5c956ba73419a91285b778bfaf440d3d7c6421216d6a88130fb09a2581c41867ef4e53f41681b808230cffc066caa94e769c6db52632d5bea13a15054554e4130303030303030303030313501581cef7a1cebb2dc7de884ddf82f8fcbc91fe9750dcd8c12ec7643a99bbea1581cdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef010b58201d221838c87c63cf7d3efe8ed7cc1940a9c0014dbbf1660792a35f72ae27bfc50d81825820e01d9c0d8709d20c1dbd35de02984cfb80094ed3dd418c6521a9762f57614cac010e81581c65647d1979b1f2438fb8133811bbcd2f08a685251509bd6525a4c4ad108258390065647d1979b1f2438fb8133811bbcd2f08a685251509bd6525a4c4ad3d654b905de11caa424287b4151712734de673af463f4ec9ef98b9861b0000000275f4eb41111a003cf0a0128382582070619986c39b08ef614ab3ec88180ce010237274e2e471e0a67cdbc9776ab97301825820017626a102f2f233711490b4bc842f13ae753d4553ee78b9be5353f494e5b92e0182582070619986c39b08ef614ab3ec88180ce010237274e2e471e0a67cdbc9776ab97300a2008182405840b6c91ff469f8233236c081e39306b166216e456f7bd43a562659f32f6c2da4f0de9bec58306b6d845ee54b55af00e09e69775468fed1c0b4bbf409e60bc6d50705a382000182d8799fd8799f500e03d7e42f754e6eee15788d621ffff058206b791f703697e54736fa4bd00ba8b861f154c3441cb7437970157bd88c13d48514582000044273d8fbac47be954061db10cb9cf558fcc46dc6e6ec8f3ef94697d3a3100319ffff1a517c7940ff9fd8799f005f58402f746e9bfe5ea386b8672aecf125f14fafc1331e36dc4fe9def5771f2b1624b1aed07e79553c0bd4af150bf54606d8096e8bc5e4b95eb130a013c5cb3e9f67ca584012e9d316e4975ed7d1a94be59b1b42664ad84984d6df2d3ec98f010a441b7513b4c6c4d2ddb59b9a267dce80601099de24ff32453777f4f515c0a996c19618f1ffffd8799f005f58406f2611df56ac874734e65413eae5d61f0b10ee0085f5961d83ce8f2e5e1a954af87ef6d6c0d3a92372884aae1f0f1702c8a2327d552b4346f801c65be3fe078c5840b7c1403c5eb2b89ea421765c1e59ebf37549ffe4d397632e78698151abcf3f5d2b6067e81e1e77b36a6877dd55f02a4b491bdf45aebe56800f4b3ede5c127a6affffd8799f005f584093becad56775b7e05d025e8fca5c86c9d5f43c026744896fbdb53a6dacf9e9c22e3833235a19dbfc481ad594440760bd7a613cebbc6c3046dcef57c05aca1bb75840bb38934c243de8efd3602529ef619e273594be8079bf367db4b281b09c95aa720000000000000000000000000000000000000000000000000000000000000000ffffff9fd87b9f0058207c09f7c4d76ace86e1a7e1c7dc0a0c7edcaa8b284949320081131976a87760c358200e5751c026e543b2e8ab2eb06099daa1d1e5df47778f7787faab45cdf12fe3a8ffff08090aff821a003567e01ac1b7108082010082d87a80821a0007a1201a3e95ba8082010182d87a80821a000f42401a000f4240f5d90103a100a11902d1a0")
        c = rawcborobj(raw_bytes)
        self.assertEqual(c.encoded(), raw_bytes.hex())

    def test_tupleindex(self):
        c = rawcborobj(bytes.fromhex("9fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0dbba000ffffffffd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0f731400ffffffffff"))

        self.assertEqual(c[0][1][0][1]['40'].encoded(), c[0,1,0,1,b'@'].encoded())



    def test_tags1(self):
        c = rawcborobj(bytes.fromhex("9fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0dbba000ffffffffd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0f731400ffffffffff"))

        self.assertEqual(c[0].tag, 121)
        self.assertEqual(c[1].tag, 121)

        self.assertEqual(c[0].encoded(), "d8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00493e00ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0dbba000ffffffff")
        self.assertEqual(c[1].encoded(), "d8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f79fd8799fd8799fd8799f581c3342ca8c073a11b7664bd105123353e79c01116cc465915133fdcf75ffd8799fd8799fd8799f581cd6c5f6f7562142b9815eacc31a3a1579991452e860aaf60573722018ffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a005265c0ffffd8799fd8799fd8799f581c7b6659ee4ed7b34fb82f3cee8e1c30a9540ed6f746f09e46b96577f7ffd8799fd8799fd8799f581c178305c0bd123855dd4433112d6081e3906d25e8b61a8574ebdafe4cffffffffa140d8799f00a1401a0f731400ffffffff")

    def test_tags1(self):
        c = rawcborobj(bytes.fromhex("c200"))
        self.assertEqual(c.tag, 2)
